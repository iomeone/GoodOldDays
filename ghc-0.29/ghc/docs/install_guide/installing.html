<p>
<html>
<!-- Generated by lit2html -->
<head>
<title>Installing the Glasgow Functional Programming Tools Version 0.26</title>
</head>
<body>
<h1>Installing the Glasgow Functional Programming Tools Version 0.26</h1>
<address>The AQUA Team (scribe: Will Partain)  Department of Computing Science  University of Glasgow  Glasgow, Scotland  G12 8QQ    Email: glasgow-haskell-{users,bugs}-request@dcs.glasgow.ac.uk<br>
</address>
<hr><p>
<p>

<a name="install-intro"><h2>Introduction</h2></a>

<p>
For most people, it should be easy to install one or more of the
Glasgow functional-programming tools (the `Glasgow tools'), most often
just the Glasgow Haskell compiler (GHC).  This document will guide you
through the installation process, and point out the known pitfalls.
<p>
Note: As of version 0.26, this document describes how to build <i>all</i> of the Glasgow tools, not just the Haskell compiler.  The
<tt>configure</tt> script, etc., has changed to cope with this wider
mandate; something to bear in mind...
<p>

<a name="install-strategy"><h3>What to install?  Starting from what?</h3></a>

<p>
Building the Glasgow tools <i>can</i> be complicated, mostly because
there are so many permutations of what/why/how, e.g., "Build Happy
with HBC, everything else with GHC, leave out profiling, and test it
all on the `real' NoFib programs."  Yeeps!
<p>
Happily, such complications don't apply to most people.  A few common
"strategies" serve most purposes.  Pick one and proceed
as suggested:
<dl>
<dt>Install from binary "bundles":
<dd>You have one of the supported
platforms (e.g., Sun4 or DEC Alpha), and you just want a Haskell
compiler, and you don't want to do anything fancy...  This choice
is for you.  Proceed to
section <a href="#installing-bin-distrib">installing-bin-distrib</a>.  HIGHLY RECOMMENDED!
<p>
<dt>Build some Glasgow tools using GHC itself:
<dd>You have a supported
platform, but (a) you like the warm fuzzy feeling of compiling things
yourself; (b) you want to build something "extra" -- e.g., a set of
libraries with strictness-analysis turned off; or (c) you want to hack
on GHC yourself.
<p>
In this case, you should install a binary distribution
(as described in section <a href="#installing-bin-distrib">installing-bin-distrib</a>),
then build GHC with it (as described in section <a href="#building-GHC">building-GHC</a>).
<p>
<dt>Build GHC from intermediate C <tt>.hc</tt> files:
<dd>You cannot get a
pre-built GHC, so you have no choice but to "bootstrap" up from the
intermediate C (<tt>.hc</tt>) files that we provide.
Building GHC on an unsupported platform falls into this category.
Please see section <a href="#booting-from-C">booting-from-C</a>.
<p>
Once you have built GHC, you can build the other Glasgow tools with
it.
<p>
<dt>Build GHC with another Haskell compiler (e.g., HBC):
<dd>Not
recommended, but see section <a href="#building-with-HBC">building-with-HBC</a>.
</dl>
<p>

<a name="port-info"><h3>What machines the Glasgow tools, version 0.26, run on</h3></a>
<a name="ports, GHC"></a>
<p>
<a name="GHC ports"></a>
<p>
<a name="supported platforms"></a>
<p>
<a name="platforms, supported"></a>
<p>
The main question is whether or not the Haskell compiler (GHC) runs on
your machine.
<p>
Bear in mind that certain "bundles", e.g. parallel Haskell, may not
work on all machines for which basic Haskell compiling is supported.
<p>
Some libraries may only work on a limited number of platforms; for
example, a sockets library is of no use unless the operating system
supports the underlying BSDisms.
<p>

<a name="ports, GHC"></a>
<a name="GHC ports"></a>
<a name="supported platforms"></a>
<a name="platforms, supported"></a>
<a name="installing_1.2.1"><h4>What machines the Haskell compiler (GHC) runs on</h4></a>

<p>
<a name="fully-supported platforms"></a>
<p>
<a name="native-code generator"></a>
<p>
<a name="registerised ports"></a>
<p>
<a name="unregisterised ports"></a>
<p>
The GHC hierarchy of Porting Goodness: (a) Best is a native-code
generator; (b) next best is a "registerised"
port; (c) the bare minimum is an "unregisterised" port.
"Unregisterised" Haskell programs are much bigger and slower,
but the port is much easier to get going.
<p>
With GHC 0.26, we add "registerised" support for some HP-PA, iX86,
and MIPS platforms.
<p>
We use Sun4s running SunOS 4.1.3 and DEC Alphas running OSF/1 V2.0,
so those are the "fully-supported" platforms, unsurprisingly.  Both
have native-code generators, for quicker compilations.
<p>
Here's everything that's known about GHC ports, as of 0.26. We
identify platforms by their "canonical GNU-style" names.  We
identify
<p>
Note that some ports are fussy about which GCC version you use; or
require GAS; or ...
<p>
<dl>
<p>
<dt><tt>alpha-dec-osf1</tt>:
<dd><a name="alpha-dec-osf1: fully supported"></a>
<p>
(We have OSF/1 V2.0.) Fully supported, including native-code generator.
We recommend GCC 2.6.x or later.
<p>
<dt><tt>sparc-sun-sunos4</tt>:
<dd><a name="sparc-sun-sunos4: fully supported"></a>
<p>
Fully supported, including native-code generator.
<p>
<dt><tt>sparc-sun-solaris2</tt>:
<dd><a name="sparc-sun-solaris2: fully supported"></a>
<p>
Fully supported, including native-code generator.  A couple of quirks,
though: (a) the profiling libraries are bizarrely huge; (b) the
default <tt>xargs</tt> program is atrociously bad for building GHC
libraries (see section <a href="#Pre-supposed">Pre-supposed</a> for details).
<p>
<dt>HP-PA box running HP/UX 9.x:
<dd><a name="hppa1.1-hp-hpux: registerised port"></a>
<p>
GHC 0.26 works registerised.  No native-code generator.
For GCC, you're best off with one of the Utah releases of
GCC 2.6.3 (`u3' or later), from <tt>jaguar.cs.utah.edu</tt>.
We don't know if straight GCC 2.7.x works or not.
<p>
Concurrent/Parallel Haskell probably don't work (yet).
<a name="hppa1.1-hp-hpux: concurrent -- no"></a>
<p>
<a name="hppa1.1-hp-hpux: parallel -- no"></a>
<p>
<dt><tt>i386-*-linuxaout</tt> (PCs running Linux -- <tt>a.out</tt> format):
<dd><a name="i386-*-linuxaout: registerised port"></a>
<p>
GHC 0.26 works registerised (no native-code generator).
You <i>must</i> have GCC 2.7.x or later.
<p>
Concurrent/Parallel Haskell probably don't work (yet).
<a name="i386-*-linuxaout: concurrent -- no"></a>
<p>
<a name="i386-*-linuxaout: parallel -- no"></a>
<p>
<a name="i386-*-linuxaout: profiling -- maybe"></a>
<p>
Profiling might work, but it is untested.
<p>
<dt><tt>mips-sgi-irix5</tt>:
<dd><a name="mips-sgi-irix5: registerised port"></a>
<p>
GHC 0.26 works registerised (no native-code generator).
I suspect any GCC 2.6.x (or later) is OK.  The GCC that I used
was built with <tt>--with-gnu-as</tt>.
<p>
Concurrent/Parallel Haskell probably don't work (yet).
Profiling might work, but it is untested.
<a name="mips-sgi-irix5: concurrent -- no"></a>
<p>
<a name="mips-sgi-irix5: parallel -- no"></a>
<p>
<a name="mips-sgi-irix5: profiling -- maybe"></a>
<p>
<dt><tt>m68k-apple-macos7</tt> (Mac, using MPW):
<dd><a name="m68k-apple-macos7: historically ported"></a>
<p>
Once upon a time, David Wright in Tasmania has actually
gotten GHC to run on a Macintosh.  Ditto James Thomson here at Glasgow.
You may be able to get Thomson's from here.  (Not sure that it will
excite you to death, but...)
<p>
No particularly recent GHC is known to work on a Mac.
<p>
<dt><tt>m68k-next-nextstep3</tt>:
<dd><a name="m68k-next-nextstep3: historically ported"></a>
<p>
Carsten Schultz succeeded with a "registerised" port of GHC 0.19.
There's probably a little bit-rot since then, but otherwise it should
still be fine.  Had a report that things were basically OK at 0.22.
<p>
Concurrent/Parallel Haskell probably won't work (yet).
<a name="m68k-next-nextstep3: concurrent -- no"></a>
<p>
<a name="m68k-next-nextstep3: parallel -- no"></a>
<p>
<dt><tt>m68k-sun-sunos4</tt> (Sun3):
<dd><a name="m68k-sun-sunos4: registerised port"></a>
<p>
GHC 0.26 works registerised.  No native-code generator.
<p>
Concurrent/Parallel Haskell probably don't work (yet).
<a name="m68k-sun-sunos4: concurrent -- no"></a>
<p>
<a name="m68k-sun-sunos4: parallel -- no"></a>
<p>
</dl>
<p>

<a name="fully-supported platforms"></a>
<a name="native-code generator"></a>
<a name="registerised ports"></a>
<a name="unregisterised ports"></a>
<a name="alpha-dec-osf1: fully supported"></a>
<a name="sparc-sun-sunos4: fully supported"></a>
<a name="sparc-sun-solaris2: fully supported"></a>
<a name="hppa1.1-hp-hpux: registerised port"></a>
<a name="hppa1.1-hp-hpux: concurrent---no"></a>
<a name="hppa1.1-hp-hpux: parallel---no"></a>
<a name="i386-*-linuxaout: registerised port"></a>
<a name="i386-*-linuxaout: concurrent---no"></a>
<a name="i386-*-linuxaout: parallel---no"></a>
<a name="i386-*-linuxaout: profiling---maybe"></a>
<a name="mips-sgi-irix5: registerised port"></a>
<a name="mips-sgi-irix5: concurrent---no"></a>
<a name="mips-sgi-irix5: parallel---no"></a>
<a name="mips-sgi-irix5: profiling---maybe"></a>
<a name="m68k-apple-macos7: historically ported"></a>
<a name="m68k-next-nextstep3: historically ported"></a>
<a name="m68k-next-nextstep3: concurrent---no"></a>
<a name="m68k-next-nextstep3: parallel---no"></a>
<a name="m68k-sun-sunos4: registerised port"></a>
<a name="m68k-sun-sunos4: concurrent---no"></a>
<a name="m68k-sun-sunos4: parallel---no"></a>
<a name="installing_1.2.2"><h4>What machines the other tools run on</h4></a>

<p>
Unless you hear otherwise, the other tools work if GHC works.
<p>
Haggis requires Concurrent Haskell to work.
<a name="Haggis, Concurrent Haskell"></a>
<p>

<a name="Haggis, Concurrent Haskell"></a>
<a name="installing_1.3"><h3>Things to check before you start typing</h3></a>

<p>
<ul>
<li><a name="disk space needed"></a>
<p>
Disk space needed: About 30MB (five hamburgers' worth) of disk space
for the most basic binary distribution of GHC; more for some
platforms, e.g., Alphas.  An extra "bundle" (e.g., concurrent
Haskell libraries) might take you to 8--10 hamburgers.
<p>
You'll need over 100MB (say, 20 hamburgers' worth) if you need to
build the basic stuff from scratch.
<p>
I don't yet know the disk requirements for the non-GHC tools.
<p>
All of the above are <i>estimates</i> of disk-space needs.
<p>
<li>Use an appropriate machine, compilers, and things.
<p>
SPARC boxes and DEC Alphas running OSF/1 are fully supported.
Section <a href="#port-info">port-info</a> gives the full run-down on ports or lack
thereof.
<p>
<li>Be sure that the "pre-supposed" utilities are installed.
<p>
For GHC, you must have <tt>perl</tt> to get anywhere at all.  If you're
going for Parallel Haskell, you'll need PVM, version 3.  You will
probably need a reasonably up-to-date GCC (GNU C compiler),
too -- section <a href="#port-info">port-info</a> lists any specific requirements in this
regard.
<p>
If you are going to be making documents [unlikely], you'll need
<tt>makeindex</tt> as well, and maybe <tt>tgrind</tt> [unlikely].  If you edit
the one or two <tt>flex</tt> files in GHC, you'll need <tt>flex</tt>, too
[unlikely].
<p>
If you end up yacc'ing the Haskell parser [unlikely], Sun's standard
<tt>/bin/yacc</tt> won't cut it.  Either the unbundled <tt>/usr/lang/yacc</tt>
or <tt>bison</tt> will do fine.  Berkeley yacc (<tt>byacc</tt>) won't do.
<p>
<li>If you have any problem when building or installing the Glasgow tools,
please check the "known pitfalls" (section <a href="#build-pitfalls">build-pitfalls</a>).  If
you feel there is still some shortcoming in our procedure or
instructions, please report it.
<p>
For GHC, please see the bug-reporting section of the User's guide
(separate document), to maximise the usefulness of your report.
<p>
If in doubt, please send a message to
<tt>glasgow-haskell-bugs@dcs.glasgow.ac.uk</tt>.
</ul>
<p>

<a name="disk space needed"></a>
<a name="installing-bin-distrib"><h2>Installing from binary distributions (the most common case)</h2></a>
<a name="binary installations"></a>
<p>
<a name="installation, of binaries"></a>
<p>
Installing from binary distributions is easiest, and recommended!
<p>

<a name="binary installations"></a>
<a name="installation, of binaries"></a>
<a name="GHC-bin-distrib"><h3>GHC from binary distributions</h3></a>
<a name="GHC installation, from binaries"></a>
<p>
<a name="installation, GHC from binaries"></a>
<p>
(Why binaries?  Because GHC is a Haskell compiler written in Haskell,
so you've got to "bootstrap" it, somehow.  We provide
machine-generated C-files-from-Haskell for this purpose, but it's
really quite a pain to use them.  If you must build GHC from its
sources, using a binary-distributed GHC to do so is a sensible way to
proceed.)
<p>
Binary distributions come in "bundles,"<a name="bundles of binary stuff"></a>
<p>
one bundle per <tt>.tar.gz</tt> file.
<p>
A basic GHC "bundle" gives you the compiler and the standard,
sequential libraries.  The files are called
<tt>ghc-0.26-&lt;platform&gt;.tar.gz</tt>, where <tt>&lt;platform&gt;</tt> is one of:
alpha-dec-osf2, hppa1.1-hp-hpux9, i386-unknown-linuxaout,
<p>
m68k-sun-sunos4, mips-sgi-irix5,
sparc-sun-sunos4, sparc-sun-solaris2.
<p>
There are plenty of "non-basic" GHC bundles.  The files for them are
called <tt>ghc-0.26-&lt;bundle&gt;-&lt;platform&gt;.tar.gz</tt>, where the
<tt>&lt;platform&gt;</tt> is as above, and <tt>&lt;bundle&gt;</tt> is one of these:
<dl>
<dt><tt>prof</tt>:
<dd>Profiling with cost-centres.  You probably want this.
<p>
<dt><tt>conc</tt>:
<dd>Concurrent Haskell features.  You may want this.
<p>
<dt><tt>par</tt>:
<dd>Parallel Haskell features (sits on top of PVM).
You'll want this if you're into that kind of thing.
<p>
<dt><tt>gran</tt>:
<dd>The "GranSim" parallel-Haskell simulator
(hmm... mainly for implementors).
<p>
<dt><tt>ticky</tt>:
<dd>"Ticky-ticky" profiling; very detailed
information about "what happened when I ran this program" -- really
for implementors.
<p>
<dt><tt>prof-conc</tt>:
<dd>Cost-centre profiling for Concurrent Haskell.
<p>
<dt><tt>prof-ticky</tt>:
<dd>Ticky-ticky profiling for Concurrent Haskell.
</dl>
<p>
One likely scenario is that you will grab <i>three</i> binary
bundles -- basic, profiling, and concurrent.  Once you have them,
unpack them all together in the same place, thusly:
<p>

<a name="GHC installation, from binaries"></a>
<a name="installation, GHC from binaries"></a>
<a name="bundles of binary stuff"></a>
<pre>
cd /put/them/in/here
gunzip &lt; ghc-0.26-sparc-sun-sunos4.tar.gz      | tar xf -
gunzip &lt; ghc-0.26-prof-sparc-sun-sunos4.tar.gz | tar xf -
gunzip &lt; ghc-0.26-conc-sparc-sun-sunos4.tar.gz | tar xf -
</pre><p>

If you unpacked the files in a way that does <i>not</i> preserve
modification times (e.g., used the <tt>m</tt> option to <tt>tar</tt> -- why on
earth you might do this, I cannot imagine), then please unpack them
again :-)  The timestamps on the files are (regrettably) important.
<p>
Here's what to do with the stuff in each directory, once unpacked.
<p>
<dl>
<p>
<dt><tt>bin/&lt;platform&gt;</tt> (sometimes just <tt>bin/</tt>):
<dd>Copy these executables so that they will be in users' PATHs.
<p>
<dt><tt>lib</tt>:
<dd>Move this directory, in toto, to wherever you want it to live.
It should still be called <tt>lib</tt>.
<p>
<dt><tt>docs</tt>:
<dd>This is the full <tt>docs</tt> tree.  Just follow the normal instructions,
in section <a href="#make-docs">make-docs</a>.
</dl>
<p>
Things you need to fiddle so the tools will spring to life:
<ul>
<li><tt>rehash</tt> (csh users), so your shell will see the new stuff in your
bin directory.
<p>
<li>CHOICE #1 (BETTER):
Edit your <tt>ghc</tt>, <tt>mkdependHS</tt>, and <tt>hstags</tt> scripts:
(a) Create a correct <tt>#!...perl</tt> first line in each one. (Ask a
Unix-friendly person to help you, if you don't know what a
<tt>#!</tt>-line is.)  (b)  Find the line that looks something like:

<pre>
# $ENV{'GLASGOW_HASKELL_ROOT'} = '/some/absolute/path/name';
</pre><p>
Remote the comment symbol (<tt>#</tt>) on the front, and change the
path name to be the right thing.
<p>
So, if your "lib" files are now in <tt>/home/myself/lib/ghc/...</tt>,
then you should set <tt>GLASGOW_HASKELL_ROOT</tt> to <tt>/home/myself</tt>.
<p>
<li>CHOICE #2:
Set your <tt>GLASGOW_HASKELL_ROOT</tt> environment variable, and
don't edit the <tt>ghc</tt>, <tt>mkdependHS</tt>, and <tt>hstags</tt> scripts
at all.
<p>
It's better to edit the scripts; that way, it's once for all.
<p>
<li>You <i>may</i> need to re-<tt>ranlib</tt> your libraries (on Sun4s).

<pre>
% cd &lt;wherever-the-lib-files-are-now&gt;/ghc/0.26/sparc-sun-sunos4
% foreach i ( `find . -name '*.a' -print` ) # or other-shell equiv...
?    ranlib $i
?    # or, on some machines: ar s $i
? end
</pre><p>

<li>Once done, test your "installation" as suggested in
section <a href="#GHC_test">GHC_test</a>.  Be sure to use a <tt>-v</tt> option, so you
can see exactly what pathnames it's using.
<p>
If things don't work, double-check your hand-edited path
names.  Things will go catastrophically wrong as long as they are
incorrect.
</ul>
<p>

<a name="non-GHC-bin-distrib"><h3>Other tools from binary distributions</h3></a>

<p>
NOT DONE YET.
<p>
All of the above is for GHC bundles.  For other tools, the same
principles apply: get the binary bundles you want, then unpack them
all together in the same place.
<p>

<a name="checklist"><h2>Building Glasgow tools from source: a checklist</h2></a>

<p>
<ul>
<li>Install any pre-supposed utility programs that you do not have at your
site.  You have to do this "by hand."  It's not hard, and these are
things you want to have anyway.  Please see section <a href="#Pre-supposed">Pre-supposed</a>.
<p>
<li>Be sure you have a suitable Haskell compiler, or else the intermediate
C (<tt>.hc</tt>) files.  In some cases, you might want an alternative set
of interface (<tt>.hi</tt>) files (quicker than generating a fresh set).
Section <a href="#install-strategy">install-strategy</a> lists the various strategies you might
adopt.
<p>
If you don't have a Haskell compiler, the most painless option is to
use a binary-distributed GHC to compile Glasgow tools (including GHC
itself) from source.  Installing a binary distribution (the first
step) is described in section <a href="#installing-bin-distrib">installing-bin-distrib</a>.
<p>
<li>You might want to write-protect your source files at this point:

<pre>
cd &lt;the-very-top-dir&gt;
find . -type f \! -name \*.hi \! -name \*.hc \! -name \*.jm -print \
        | xargs chmod a-w
</pre><p>

<li>Run the <tt>configure</tt> script.  It is a shell script that looks around
to find out things about your system.  You can see the <tt>configure</tt>
options by passing it a <tt>--help</tt> flag, or by reading
section <a href="#Configuring">Configuring</a>.
<p>
<li>Once configured, build the basic support utilities and make your
Makefiles, including the automagically-created dependencies between
files.  The near-universal incantation is:

<pre>
% cd &lt;the-very-top-dir&gt;
% sh &lt; STARTUP &gt;&amp; startup.log   # and chk the log afterwards!
</pre><p>

<li>Build the Glasgow tools you are interested in, as <tt>STARTUP</tt> suggests:

<pre>
% cd &lt;the-very-top-dir&gt;/&lt;tool&gt;
% make all &gt;&amp; make.log          # time to go to lunch!
</pre><p>
Consult the list of known pitfalls (section <a href="#build-pitfalls">build-pitfalls</a>) if
something goes wrong.
<p>
<li>Test what you've built, enough to know that it's working.
<p>
<li>Actually install the tools, if you wish:

<pre>
% cd &lt;the-very-top-dir&gt;/&lt;tool&gt;
% make install
</pre><p>

<li>Make and/or install the documentation.
<p>
<li>Save a copy of your <tt>config.status</tt> file, for the next
even-more-wonderful release!
<p>
<li>If you're finished, tidy up after yourself [<tt>make clean</tt>], if you
want to.
<p>
Alternatively, <tt>/bin/rm -rf &lt;tool&gt;</tt> :-)
</ul>
<p>

<a name="building-GHC"><h2>Building the Glasgow Haskell Compiler (GHC)</h2></a>
<a name="GHC installation, from sources"></a>
<p>

<a name="GHC installation, from sources"></a>
<a name="installing_5"><h2>Building GHC from source, compiling it with itself</h2></a>
<a name="building GHC with itself"></a>
<p>
<a name="booting GHC with itself"></a>
<p>
This section describes how to build GHC from source.  You would do
this if (a) there is no "canned" binary distribution for your
machine, (b) the binary distribution omits features that you want,
(c) you want to make changes to GHC and them build them in, or
(d) you like torturing yourself.
<p>
This blow-by-blow description follows the general checklist in
section <a href="#checklist">checklist</a>.
<p>

<a name="building GHC with itself"></a>
<a name="booting GHC with itself"></a>
<a name="Right-compiler-and-files"><h3>Do you have a suitable compiler and/or <tt>.hc</tt> files and/or <tt>.hi</tt> files?</h3></a>
<a name="booting GHC, files needed"></a>
<p>
We now proceed through each installation step, carefully.
<p>
Because the compiler heart of Glorious Glasgow Haskell is written in
Haskell, you have to use some "bootstrapping" mechanism.
<p>
Your best choice, if available, is to use a binary distribution for
your platform; i.e., compile GHC 0.26 with a GHC 0.26 that we have
provided.  Please see section <a href="#installing-bin-distrib">installing-bin-distrib</a> for how to
install a binary distribution.
<p>
Your remaining choice is to use the intermediate C (<tt>.hc</tt>) files that we
supply.  This is the <i>only</i> choice for anyone trying to port to
a new or weakly-supported system.
<p>
The main drawback of the supplied-<tt>.hc</tt> approach is that you will
have a lot of very bulky intermediate files on your disk for a while.
<p>
One obscure note: if you're going to build GHC to have a native-code
generator, you're well advised to get a suitable set of interface
files (to save making them yourself).  Please see section <a href="#Compiler_reconfig">Compiler_reconfig</a>
if you plan to end up with a native-code generator.
<p>

<a name="booting GHC, files needed"></a>
<a name="installing_5.2"><h3>Write-protecting your source files</h3></a>
<a name="write-protecting source files"></a>
<p>
At this point, some people like to write-protect their source files against
inadvertent change:

<a name="write-protecting source files"></a>
<pre>
cd &lt;very-top-dir&gt;
find . -type f \! -name '*.hi' \! -name \*.hc \! -name '*.jm' -print \
        | xargs chmod a-w
</pre><p>

<p>

<a name="installing_5.3"><h3>Running <tt>configure</tt> and <tt>STARTUP</tt> for GHC</h3></a>
<a name="configure, for GHC"></a>
<p>
<a name="STARTUP, for GHC"></a>
<p>
The <tt>configure</tt> script finds out things about your machine.  It
also allows you to specify features to include/exclude from your GHC
installation.
<p>
Please see section <a href="#Configuring">Configuring</a> for all about <tt>configure</tt>, and
section <a href="#Configuring-GHC">Configuring-GHC</a> for details of GHC configuring (including
examples).
<p>
Once <tt>configure</tt> runs successfully, do as it says and do
<tt>sh &lt; STARTUP</tt>.
<p>

<a name="configure, for GHC"></a>
<a name="STARTUP, for GHC"></a>
<a name="installing_5.4"><h3>Build the compiler!</h3></a>
<a name="make all, for GHC"></a>
<p>
Do the main GHC build, just as <tt>STARTUP</tt> suggests:

<a name="make all, for GHC"></a>
<pre>
% cd ghc
% make all &gt;&amp; make.log
</pre><p>
If this fails or something seems suspicious, check the "known
pitfalls" (section <a href="#build-pitfalls">build-pitfalls</a>).  If you can't figure out how
to proceed, please get in touch with us.
<p>
If you have to restart the build, for whatever reason, you are just as
well to make the whole thing; i.e., re-do as described above.  (Well,
the <tt>compiler</tt> and <tt>lib</tt> subdirectories are the last two; if the
build "dies" in one of them, it is usually safe to finish the job by
hand.)
<p>

<a name="GHC_test"><h3>Test that GHC seems to be working</h3></a>
<a name="testing a new GHC"></a>
<p>
The way to do this is, of course, to compile and run <i>this</i> program
(in a file <tt>Main.hs</tt>):

<a name="testing a new GHC"></a>
<pre>
main = putStr "Hello, world!\n"
</pre><p>

First, give yourself a convenient way to execute the driver script
<tt>ghc/driver/ghc</tt>, perhaps something like...

<pre>
% ln -s /local/src/ghc-0.26/ghc/driver/ghc ~/bin/sun4/ghc
% rehash
</pre><p>

Compile the program, using the <tt>-v</tt> (verbose) flag to verify that
libraries, etc., are being found properly:

<pre>
% ghc -v -o hello -fhaskell-1.3 Main.hs
</pre><p>

Now run it:

<pre>
% ./hello
Hello, world!
</pre><p>

Some simple-but-profitable tests are to compile and run the
notorious <tt>nfib</tt> program, using different numeric types.  Start
with <tt>nfib :: Int -&gt; Int</tt>, and then try <tt>Integer</tt>, <tt>Float</tt>,
<tt>Double</tt>, <tt>Rational</tt> and maybe <tt>Complex Float</tt>.  Code
for this is distributed in <tt>ghc/misc/examples/nfib/</tt>.
<p>
For more information on how to "drive" GHC,
either do <tt>ghc -help</tt> or consult the User's Guide (distributed in
<tt>ghc/docs/users_guide</tt>).
<p>

<a name="GHC_install"><h3>Actually installing GHC</h3></a>
<a name="make install, GHC"></a>
<p>
<a name="installing, GHC"></a>
<p>
"Installing GHC" means copying the files required to run it to their
"permanent home."  You can then delete, or at least tidy up, your
source directory.
<p>
If you have no reason to install GHC, you can execute directly out of
the source tree, as sketched in the section above
(section <a href="#GHC_test">GHC_test</a>).
<p>
Assuming that everything's OK so far, all you need to do is:

<a name="make install, GHC"></a>
<a name="installing, GHC"></a>
<pre>
% cd &lt;very-top&gt;/ghc
% make install
</pre><p>

If you're a little dubious (as I usually am), you can always do a
"trial run" first:

<pre>
% cd &lt;very-top&gt;/ghc
% make -n install &gt;&amp; temp-log-file-to-look-at
</pre><p>

In both cases, if something breaks, it's a <i>bug</i>.
<p>

<a name="make-docs"><h3>Installing the GHC documentation (optional)</h3></a>
<a name="documentation, making"></a>
<p>
<a name="make docs, GHC"></a>
<p>
<a name="installing documentation"></a>
<p>
Because our documentation is in DVI/Info formats, and because there is
no standard practice about how such documents are "installed," we
haven't tried to automate this (at least not enough that we promise it
works).
<p>
You can find all the documentation in the distribution with:

<a name="documentation, making"></a>
<a name="make docs, GHC"></a>
<a name="installing documentation"></a>
<pre>
% cd ghc/docs
% find . \( -name '*.dvi' -o -name '*.info' -o -name '*.html' \) -print
</pre><p>

If you have a standard place to put such files, just copy
them there.  (Better ideas welcome.)
<p>
The following "man" pages are hidden around in the distribution:

<pre>
ghc/utils/hp2ps/hp2ps.1
literate/info-utils/info.1
glafp-utils/scripts/mkdirhier.man
glafp-utils/scripts/lndir.man
</pre><p>
Please install them by hand if you need to.
<p>

<a name="clean-up"><h3>Cleaning up after yourself</h3></a>
<a name="make clean, GHC"></a>
<p>
<a name="cleaning up afterwards"></a>
<p>
<tt>make clean</tt> is the basic command to tidy things up.  However: if
you do this, <i>you will not be able to execute directly out of the
source tree thereafter!</i> (as sketched in section <a href="#GHC_test">GHC_test</a>).  Nor will
you be able to make documents, etc. -- you would have to re-build parts
of GHC first.
<p>
If you want to execute out of the source tree but would like to clear
off lots and lots of stuff, you can do:

<a name="make clean, GHC"></a>
<a name="cleaning up afterwards"></a>
<pre>
% cd ghc/lib    # scrub library C and object files
% rm */*.hc
% find . -name '*.o' -print | xargs /bin/rm

% cd ghc/compiler   # scrub compiler object files
% rm */*.o
% rm */*.hc         # if you have been keeping them around
</pre><p>
(You can scrub the object files in <tt>ghc/runtime</tt> similarly -- except
<tt>main/TopClosure*.o</tt>.)
<p>

<a name="booting-from-C"><h2>Booting/porting from C (<tt>.hc</tt>) files</h2></a>
<a name="building GHC from .hc files"></a>
<p>
<a name="booting GHC from .hc files"></a>
<p>
This section is for people trying to get GHC going by using the
supplied intermediate C (<tt>.hc</tt>) files.  This would probably be
because no binaries have been provided, or because the machine
is not "fully supported."
<p>
To boot from C (<tt>.hc</tt>) files, you need the regular source distribution
(<tt>ghc-0.26-src.tar.gz</tt>) and also some extra files in
<tt>ghc-0.26-hc-files.tar.gz</tt>.  DON'T FORGET any extra <tt>.hc</tt>
files for profiling, concurrent, parallel, ...
<p>
Whatever you want to build, just unpack all the files "together":

<a name="building GHC from .hc files"></a>
<a name="booting GHC from .hc files"></a>
<pre>
% cd &lt;wherever&gt;
% gunzip -c ghc-0.26-src.tar.gz      | tar xf -
% gunzip -c ghc-0.26-hc-files.tar.gz | tar xf -      # basic...
% gunzip -c ghc-0.26-prof-hc-files.tar.gz | tar xf - # profiling...
% gunzip -c ghc-0.26-conc-hc-files.tar.gz | tar xf - # concurrent...
... etc ...
</pre><p>

For the "it's been tried before" machines, the normal
configure/build procedure will probably work; just keep your eyes
peeled for mischief.
<p>
WORD OF WISDOM: Be sure you have a suitable GCC (GNU C compiler); please
see section <a href="#port-info">port-info</a> for any specific requirements for your machine.
<p>
You'll need plenty of disk space to do this whole procedure!
<p>

<a name="installing_6.1"><h3>Do <tt>configure</tt>; <tt>sh &lt; STARTUP</tt>; <tt>cd ghc; make all</tt>; test it!</h3></a>
<a name="configure, GHC with .hc files"></a>
<p>
<a name="make all, GHC with .hc files"></a>
<p>
Go ahead and try <tt>configure</tt>, as described Section <a href="#Configuring">Configuring</a>
(GHC specifics in Section <a href="#Configuring-GHC">Configuring-GHC</a>).
<p>
The key <tt>configure</tt> option is <tt>--with-hc=c</tt>.  A typical
going-via-C invocation might be:
<p>

<a name="configure, GHC with .hc files"></a>
<a name="make all, GHC with .hc files"></a>
<pre>
% ./configure  --prefix=/local/fp --with-hc=c   # basic + profiling
</pre><p>

Other common possibilities might be:
<p>

<pre>
% ./configure --with-hc=c --disable-profiling   # basic only

% ./configure --with-hc=c --enable-concurrent --enable-parallel
        # basic + profiling + concurrent + parallel
</pre><p>

<p>
Next, run <tt>STARTUP</tt> in the usual way, as described in
Section <a href="#STARTUP">STARTUP</a>.
<p>
It's now time to type <tt>cd ghc; make all</tt>!  This "should" work,
especially, on a known machine.  Also, it can take a VERY long time
(esp. on oldish machines), so it's good to run overnight, on a quiet
machine, nice'd, etc., etc.
<p>
When it's all built, test your alleged GHC system, as suggested in
section <a href="#GHC_test">GHC_test</a>.
<p>

<a name="Compiler_reconfig"><h3>Building GHC again after you've bootstrapped</h3></a>
<a name="GHC reconfiguration, after booting"></a>
<p>
<a name="booting, then GHC reconfigure"></a>
<p>
<a name="native-code generator, after booting"></a>
<p>
Two reasons why you might want to re-configure and re-build GHC after
an initial boot are: (a) to get a native-code generator, or (b) if you
are going to hack on GHC.
<p>
The reason you must rebuild to get a native-code generator: The
<tt>.hc</tt> files will <i>not</i> turn into a native-code generator, and
the distributed <tt>.hi</tt> files "match" those <tt>.hc</tt> files.
<p>
From here on, I presume you've installed your booted GHC as
<tt>ghc-0.26</tt>.
<p>
If you are going for a native-code generator, you can save yourself
some re-compiling by getting a suitable set of interface (<tt>.hi</tt>)
files, for GHC for your machine.  You should end up doing, for example:

<a name="GHC reconfiguration, after booting"></a>
<a name="booting, then GHC reconfigure"></a>
<a name="native-code generator, after booting"></a>
<pre>
cd ghc-0.26/ghc/compiler # note where you are!

rm */*.o    # scrub the old compiler files

gunzip -c ghc-0.26-hi-files-alpha.tar.gz | tar xfv -
</pre><p>

Now you can configure as before, but using <tt>--with-hc=ghc-0.26</tt>
(<tt>config.status</tt> records what you did before).
<p>
Running <tt>sh &lt; STARTUP</tt> isn't strictly necessary; you only need to
rebuild in <tt>ghc/compiler</tt>:

<pre>
cd ghc-0.26/ghc/compiler
make Makefile   # if you didn't STARTUP...

make all EXTRA_HC_OPTS=-fvia-C  # -fvia-C important!
make all EXTRA_HC_OPTS=-fvia-C  # again, until .hi files settle...
</pre><p>

You might want to to again test GHC "out of the build" before you
type <tt>make install</tt> in <tt>ghc/compiler</tt> to finish the job.
<p>

<a name="building-with-HBC"><h2>Building GHC with HBC or other funny Haskell compilers</h2></a>
<a name="GHC, building with HBC"></a>
<p>
<a name="GHC, building with old GHCs"></a>
<p>
<a name="GHC, building with other compilers"></a>
<p>
GHC 0.26 doesn't build with HBC.  (It could, but we haven't put in
the effort to maintain it.)
<p>
GHC 0.26 is best built with itself, GHC 0.26.  We heartily recommend
it.  GHC 0.26 can certainly be built with GHC 0.23 or 0.24, and with
some earlier versions, with some effort.
<p>
GHC has never been built with compilers other than GHC and HBC.
<p>

<a name="GHC, building with HBC"></a>
<a name="GHC, building with old GHCs"></a>
<a name="GHC, building with other compilers"></a>
<a name="Pre-supposed"><h2>Installing pre-supposed utilities</h2></a>
<a name="pre-supposed utilities"></a>
<p>
<a name="utilities, pre-supposed"></a>
<p>
Here are the gory details about some utility programs you may need;
<tt>perl</tt> and <tt>gcc</tt> are the only important ones. (PVM is important if you're going for Parallel Haskell.) The
<tt>configure</tt> script will tell you if you are missing something.
<p>
<dl>
<dt>Perl:
<dd><a name="pre-supposed: Perl"></a>
<p>
<a name="Perl, pre-supposed"></a>
<p>
<i>You have to have Perl to proceed!</i> Perl is a language quite good
for doing shell-scripty tasks that involve lots of text processing.
It is pretty easy to install.
<p>
(We still assume Perl version 4; experience suggests that Perl 5
is fine, too.)
<p>
Perl should be put somewhere so that it can be invoked by the <tt>#!</tt>
script-invoking mechanism. (I believe <tt>/usr/bin/perl</tt> is preferred;
we use <tt>/usr/local/bin/perl</tt> at Glasgow.)  The full pathname should
be less than 32 characters long.
<p>
Perl version 4.035 has a bug to do with recursion that will bite if
you run the <tt>lit2texi</tt> script, when making Info files from
"literate" files of various sorts.  Either use a more recent version
(4.036, or 5.00n) or an older version
(e.g., perl 4.019).
<p>
<dt>GNU C (<tt>gcc</tt>):
<dd><a name="pre-supposed: GCC (GNU C compiler)"></a>
<p>
<a name="GCC (GNU C compiler), pre-supposed"></a>
<p>
The current version is 2.7.0, and has no problems that we know of.
<p>
If your GCC dies with "internal error" on some GHC source file,
please let us know, so we can report it and get things improved.
(Exception: on <tt>iX86</tt> boxes -- you may need to fiddle with GHC's
<tt>-monly-N-regs</tt> option; ask if confused...)
<p>
<dt>PVM version 3:
<dd><a name="pre-supposed: PVM3 (Parallel Virtual Machine)"></a>
<p>
<a name="PVM3 (Parallel Virtual Machine), pre-supposed"></a>
<p>
PVM is the Parallel Virtual Machine on which Parallel Haskell programs
run.  Underneath PVM, you can have (for example) a network of
workstations (slow) or a multiprocessor box (faster).
<p>
The current version of PVM is 3.3.7.  It is readily available on
the net; I think I got it from <tt>research.att.com</tt>, in <tt>netlib</tt>.
<p>
A PVM installation is slightly quirky, but easy to do.  Just follow
the <tt>Readme</tt> instructions.
<p>
<dt><tt>xargs</tt> on Solaris2:
<dd><a name="xargs, presupposed (Solaris only)"></a>
<p>
<a name="Solaris: alternative xargs"></a>
<p>
The GHC libraries are put together with something like:

<a name="pre-supposed utilities"></a>
<a name="utilities, pre-supposed"></a>
<a name="pre-supposed: Perl"></a>
<a name="Perl, pre-supposed"></a>
<a name="pre-supposed: GCC (GNU C compiler)"></a>
<a name="GCC (GNU C compiler), pre-supposed"></a>
<a name="pre-supposed: PVM3 (Parallel Virtual Machine)"></a>
<a name="PVM3 (Parallel Virtual Machine), pre-supposed"></a>
<a name="xargs, presupposed (Solaris only)"></a>
<a name="Solaris: alternative xargs"></a>
<pre>
find bunch-of-dirs -name '*.o' -print | xargs ar q ...
</pre><p>
Unfortunately the Solaris <tt>xargs</tt> (the shell-script equivalent
of <tt>map</tt>) only "bites off" the <tt>.o</tt> files a few at a
time -- with near-infinite rebuilding of the symbol table in
the <tt>.a</tt> file.
<p>
The best solution is to install a sane <tt>xargs</tt> from the GNU
findutils distribution.  You can unpack, build, and install the GNU
version in the time the Solaris <tt>xargs</tt> mangles just one GHC
library.
<p>
<dt><tt>bash</tt> (Parallel Haskell only):
<dd><a name="bash, presupposed (Parallel Haskell only)"></a>
<p>
Sadly, the <tt>gr2ps</tt> script, used to convert "parallelism profiles"
to PostScript, is written in Bash (GNU's Bourne Again shell).
This bug will be fixed.
<p>
<dt>Makeindex:
<dd><a name="pre-supposed: makeindex"></a>
<p>
<a name="makeindex, pre-supposed"></a>
<p>
You won't need this unless you are re-making our documents.  Makeindex
normally comes with a <b>TeX</b> distribution, but if not, we can provide
the latest and greatest.
<p>
<dt>Tgrind:
<dd><a name="pre-supposed: tgrind"></a>
<p>
<a name="tgrind, pre-supposed"></a>
<p>
This is required only if you remake lots of our documents <i>and</i>
you use the <tt>-t tgrind</tt> option with <tt>lit2latex</tt> (also literate
programming), to do "fancy" typesetting of your code.  <i>Unlikely.</i>
<p>
<dt>Flex:
<dd><a name="pre-supposed: flex"></a>
<p>
<a name="flex, pre-supposed"></a>
<p>
This is a quite-a-bit-better-than-Lex lexer.  Used in the
literate-programming stuff.  You won't need it unless you're hacking
on some of our more obscure stuff.
<p>
<dt>Something other than Sun's <tt>/usr/bin/yacc</tt>:
<dd><a name="pre-supposed: non-worthless Yacc"></a>
<p>
<a name="Yacc, pre-supposed"></a>
<p>
If you mess with the Haskell parser, you'll need a Yacc that can cope.
The unbundled <tt>/usr/lang/yacc</tt> is OK; the GNU <tt>bison</tt> is OK;
Berkeley yacc, <tt>byacc</tt>, is not OK.
</dl>
<p>

<a name="bash, presupposed (Parallel Haskell only)"></a>
<a name="pre-supposed: makeindex"></a>
<a name="makeindex, pre-supposed"></a>
<a name="pre-supposed: tgrind"></a>
<a name="tgrind, pre-supposed"></a>
<a name="pre-supposed: flex"></a>
<a name="flex, pre-supposed"></a>
<a name="pre-supposed: non-worthless Yacc"></a>
<a name="Yacc, pre-supposed"></a>
<a name="build-pitfalls"><h2>Known pitfalls in building Glasgow Haskell</h2></a>
<a name="problems, building"></a>
<p>
<a name="pitfalls, in building"></a>
<p>
<a name="building pitfalls"></a>
<p>
WARNINGS about pitfalls and known "problems":
<p>
<ul>
<p>
<li>One difficulty that comes up from time to time is running out of space
in <tt>/tmp</tt>.  (It is impossible for the configuration stuff to
compensate for the vagaries of different sysadmin approaches re temp
space.)
<p>
The quickest way around it is <tt>setenv TMPDIR /usr/tmp</tt> or
even <tt>setenv TMPDIR .</tt> (or the equivalent incantation with the
shell of your choice).
<p>
The best way around it is to use the <tt>--with-tmpdir=&lt;dir&gt;</tt> option
to <tt>configure</tt>.  Then GHC will use the appropriate directory
in all cases.
<p>
<li>When configuring the support code (mkworld, glafp-utils, etc.), you
will see mention of <tt>NO_SPECIFIC_PROJECT</tt> and
<tt>NO_SPECIFIC_VERSION</tt>.  This is cool.
<p>
<li>In compiling some support-code bits, e.g., in <tt>ghc/runtime/gmp</tt> and
even in <tt>ghc/lib</tt>, you may get a few C-compiler warnings.  We think
these are OK.
<p>
<li>In 0.26, when compiling via C, you'll sometimes get "warning:
assignment from incompatible pointer type" out of GCC.  Harmless.
<p>
<li>Similarly, <tt>ar</tt>chiving warning messages like the following are not
a problem:

<a name="problems, building"></a>
<a name="pitfalls, in building"></a>
<a name="building pitfalls"></a>
<pre>
ar: filename GlaIOMonad__1_2s.o truncated to GlaIOMonad_
ar: filename GlaIOMonad__2_2s.o truncated to GlaIOMonad_
...
</pre><p>

<p>
<li>Also harmless are some specialisation messages that you may see when
compiling GHC; e.g.:

<pre>
SPECIALISATION MESSAGES (Desirable):
*** INSTANCES
{-# SPECIALIZE instance Eq [Class] #-}
{-# SPECIALIZE instance Eq (Class, [Class]) #-}
{-# SPECIALIZE instance Outputable [ClassOp] #-}
{-# SPECIALIZE instance Outputable [Id] #-}
</pre><p>

<p>
<li>In compiling the compiler proper (in <tt>compiler/</tt>), you <i>may</i> get an
"Out of heap space" error message.  These
can vary with the vagaries of different systems, it seems.  The
solution is simple: (1) add a suitable <tt>-H</tt> flag to the <tt>compile</tt>
macro for the offending module,
in <tt>ghc/compiler/Jmakefile</tt> (towards the end);
(2) re-<tt>make Makefile</tt> in that directory; (3) try again: <tt>make</tt>.
<p>
Alternatively, just cut to the chase scene:

<pre>
% cd ghc/compiler
% make EXTRA_HC_OPTS=-H32m  # or some nice big number
</pre><p>

<p>
<li>Not too long into the build process, you may get a huge complaint
of the form:

<pre>
Giant error 'do'ing getopts.pl:  at ./lit2pgm.BOOT line 27.
</pre><p>
This indicates that your <tt>perl</tt> was mis-installed; the binary is
unable to find the files for its "built-in" library.  Speak to your
perl installer, then re-try.
<p>
<li>If you try to compile some Haskell, and you get errors from GCC
about lots of things from <tt>/usr/include/math.h</tt>, then your GCC
was mis-installed.  <tt>fixincludes</tt> wasn't run when it should've
been.
<p>
As <tt>fixincludes</tt> is now automagically run as part of GCC
installation, this bug also suggests that you have an old GCC.
<p>
<li>If you end up making documents that involve (La)TeX and/or <tt>tib</tt>
(Simon's favourite), the odds are that something about your/our setup
will reach out and bite you.  Yes, please complain; meanwhile,
you can do <tt>make -n whatever.dvi</tt> to see the intended commands,
then try to muddle through, doing them by hand.
<p>
</ul>
<p>

<a name="weird-configs"><h2>Making weird GHC configurations</h2></a>
<a name="GHC unusual configurations"></a>
<p>
The usual way to build a "weird" GHC configuration is to turn
various <tt>configure</tt> knobs, e.g., <tt>--enable-concurrent</tt>.
Please see section <a href="#Configuring-GHC">Configuring-GHC</a> about GHC configuring.
<p>
If you want to build some Very Customised GHC libraries, it's
probably best to send email to us, asking how.
<p>
<p>

<a name="GHC unusual configurations"></a>
<a name="building-Haggis"><h2>Building Haggis (Haskell GUI toolkit)</h2></a>
<a name="Haggis, building"></a>
<p>
<a name="building Haggis"></a>
<p>
NOT DONE YET.
<p>

<a name="Haggis, building"></a>
<a name="building Haggis"></a>
<a name="building-Happy"><h2>Building Happy (Haskell parser generator)</h2></a>
<a name="Happy, building"></a>
<p>
<a name="building Happy"></a>
<p>
NOT DONE YET.
<p>

<a name="Happy, building"></a>
<a name="building Happy"></a>
<a name="building-NoFib"><h2>Building NoFib (Haskell benchmark suite)</h2></a>
<a name="NoFib suite, building"></a>
<p>
<a name="building the NoFib suite"></a>
<p>
NOT DONE YET.
<p>

<a name="NoFib suite, building"></a>
<a name="building the NoFib suite"></a>
<a name="Configuring"><h2>Running <tt>configure</tt></h2></a>
<a name="configure script"></a>
<p>
The GNU-style <tt>configure</tt> script figures out things which we need
to know to build one or more Glasgow tools for your machine.  Also,
<tt>configure</tt> lets you specify what you want built.
<p>
Most people will configure/build one tool at a time.  The
"short-cut" instructions
for GHC are in section <a href="#Configuring-GHC">Configuring-GHC</a>,
for Haggis in section <a href="#Configuring-Haggis">Configuring-Haggis</a>,
for Happy in section <a href="#Configuring-Happy">Configuring-Happy</a>,
and for NoFib in section <a href="#Configuring-NoFib">Configuring-NoFib</a>.
<p>
However, <tt>configure</tt> lets you pick and choose, so you can build
several things "in a one-er".  Just fling in all the options
at once, and be amazed.
<p>

<a name="configure script"></a>
<a name="Configuring-general"><h3><tt>configure</tt> options for all tools</h3></a>
<a name="Configuring (general)"></a>
<p>
Many <tt>configure</tt> options apply no matter what tools you are building.
<p>
<dl>
<dt><tt>--help</tt>:
<dd>(a standard GNU option)
<a name="--help configure option"></a>
<p>
Prints out a long usage message.  The first part is GNU boilerplate;
after that is the Glasgow info.
<p>
<dt><tt>--prefix=</tt><i>directory</i>:
<dd>(a standard GNU option)
<a name="--prefix configure option"></a>
<p>
Sets the "root" directory for where a system should be installed;
defaults to <tt>/usr/local</tt>.
<p>
With Happy, for example, the main <tt>happy</tt> binary will end up in
<tt>/usr/local/bin/happy</tt>.
<p>
<dt><tt>--exec-prefix=</tt><i>directory</i>:
<dd>(a standard GNU option)
<a name="--exec-prefix configure option"></a>
<p>
Sets the "root" directory
for where executables
(e.g., the GHC driver) should be installed; defaults to whatever
<tt>--prefix</tt> is,
meaning that things will be installed in <tt>/usr/local/bin</tt>.
<p>
<dt><tt>--with-hc=</tt><i>hask</i>:
<dd><a name="--with-hc configure option"></a>
<p>
Use <i>hask</i> as my "installed Haskell compiler."
<p>
The name <i>hask</i> has to be one of <tt>ghc*</tt> (for Glasgow Haskell),
<tt>hbc*</tt> (for Chalmers HBC), or <tt>nhc*</tt> (for Rojemo's NHC).
We hope to add more!
<p>
As a special case, <tt>--with-hc=c</tt> means "I don't have a Haskell
compiler, please compile from intermediate C files (produced by GHC
somewhere else)."
<p>
<dt><tt>--with-tmpdir=</tt><i>directory</i>:
<dd>Set the directory where temporary files should be created.  This is
<tt>/tmp</tt> by default, which is Sometimes Uncool (because, e.g.,
<tt>/tmp</tt> is too small).  There's just no telling.
<p>
On our Alphas, for example, we use <tt>--with-tmpdir=/usr/tmp</tt>.
<p>
<dt><tt>--with-max-heap=</tt><i>size</i>:
<dd>When whatever Haskell compiler is run while building the Glasgow
tools, it will try to use some sane-but-not-too-big heap size.  If you
have a machine with plenty of memory, you might want to say "Go ahead
and use a great big heap."  This option allows this.  So, for
example, on our Alphas we might say <tt>--with-max-heap=48m</tt>.
</dl>
<p>

<a name="Configuring (general)"></a>
<a name="--help configure option"></a>
<a name="--prefix configure option"></a>
<a name="--exec-prefix configure option"></a>
<a name="--with-hc configure option"></a>
<a name="Configuring-GHC"><h3>GHC-specific things in <tt>configure</tt></h3></a>
<a name="Configuring for GHC"></a>
<p>
The easiest way to see all the <tt>configure</tt> options for GHC is to
type <tt>./configure --help</tt>.  (I don't feel like typing the whole
thing again, into this document...)
<p>
Some common combinations would be:
<p>

<a name="Configuring for GHC"></a>
<pre>
./configure --prefix=/users/fp/partain --with-hc=c --disable-profiling
    # use .hc files; don't bother with profiling

./configure --with-hc=ghc-0.26 --with-readline-library --with-sockets-library
    # simple build with itself; for Sun4s &amp; Alphas, you
    # should grab &amp; use ghc-0.26-hi-files-&lt;blah&gt;.tar.gz
    # (because those machines have a native-code generator).
    # For the extra libraries, you've got to have the right
    # stuff to link to.

./configure --with-hc=ghc-0.26 --disable-hsc-optimised --enable-hsc-debug
    # Don't use -O on GHC itself; turn on -DDEBUG.
    # Slows things way down, but it's the right thing if
    # you're hacking on GHC and doing lots of recompilations.

./configure --with-hc=c --enable-concurrent --enable-parallel --with-tmpdir=/usr/tmp
    # Do everything from .hc files; besides the normal ones,
    # you'll need the "prof", "conc" and "par" .hc files.
    # Use /usr/tmp as TMPDIR...
</pre><p>

Remember, if you build <tt>--with-hc=c</tt> on a Sun4 or Alpha, you
do <i>not</i> have a native-code generator.
<p>

<a name="Configuring-Haggis"><h3>Haggis-specific things in <tt>configure</tt></h3></a>
<a name="Configuring for Haggis"></a>
<p>
Use <tt>--enable-haggis</tt>.  If you have Haggis and GHC in the same
build tree but only want to build Haggis, use <tt>--disable-ghc</tt>.
<p>
MORE TO COME.
<p>

<a name="Configuring for Haggis"></a>
<a name="Configuring-Happy"><h3>Happy-specific things in <tt>configure</tt></h3></a>
<a name="Configuring for Happy"></a>
<p>
Use <tt>--enable-happy</tt>.  If you have Happy and GHC in the same
build tree but only want to build Happy, use <tt>--disable-ghc</tt>.
<p>
MORE TO COME.
<p>

<a name="Configuring for Happy"></a>
<a name="Configuring-NoFib"><h3>NoFib-specific things in <tt>configure</tt></h3></a>
<a name="Configuring for NoFib"></a>
<p>
Use <tt>--enable-nofib</tt>.  If you have NoFib and GHC in the same build
tree but only want to build the NoFib suite, use <tt>--disable-ghc</tt>.
<p>
You may want to enable or disable various sets of tests, as
suggested by <tt>./configure --help</tt>.  If you use <tt>--enable-all-tests</tt>,
be aware that many of them are GHC-specific.  Also, we may not have
given you all of the source :-)
<p>

<a name="Configuring for NoFib"></a>
<a name="STARTUP"><h2>Running <tt>STARTUP</tt></h2></a>
<a name="STARTUP script"></a>
<p>
Once you've <tt>configure</tt>d, utter the magic incantation:

<a name="STARTUP script"></a>
<pre>
% sh &lt; STARTUP &gt;&amp; startup.log
</pre><p>
The reason you might want to pipe the chatter into a file is so you
can check it afterwards.  It should be pretty obvious if it is happy.
Note: it takes a little while.
<p>
<tt>STARTUP</tt> is a simple shell script that builds <tt>mkworld</tt>
(Makefile-generating system), <tt>literate</tt> (literate-programming
system), and <tt>glafp-utils</tt> (a few utility programs); then makes the
Makefiles and dependencies for everything.
<p>
If you have any problems before getting through <tt>STARTUP</tt>, you
are probably best off re-running <tt>configure</tt> and <tt>STARTUP</tt>
(after fixing what was broken).
<p>

<a name="utils_install"><h2>Installing the support software (optional)</h2></a>
<a name="utilities, installing"></a>
<p>
By default, the support software that comes with the Glasgow
tools -- <tt>mkworld</tt>, <tt>literate</tt>, and <tt>glafp-utils</tt> -- is not
installed.  However, they're generally-useful tools, so...
<p>
If you did want to install the "make world" system, for example:

<a name="utilities, installing"></a>
<pre>
% cd &lt;very-top&gt;/mkworld
% make install
</pre><p>

If it isn't installing things where you want it to, you can either
fiddle things on the fly...

<pre>
% make install prefix=/home/sweet/home
</pre><p>

If you want to install just one utility, for example <tt>lndir</tt>:

<pre>
% cd &lt;very-top&gt;/glafp-utils/scripts
% make install_lndir
</pre><p>

"Make world" -- It slices, it dices... it's great!
<p>

<a name="arrangement-of-sources"><h2>Arrangement of the sources</h2></a>

<p>
Once you un<tt>tar</tt> the Glorious Haskell Compilation (GHC) system sources
and <tt>cd</tt> into the top directory, here's a bird's-eye view of what
you should see:
<p>

<pre>
mkworld/              "Make world" sub-system for configuring the system.                
                                                                                         
glafp-utils/          Utility programs and scripts used in building the distribution;    
                      often acquired from elsewhere.                                     
literate/             Glasgow literate programming sub-system.                           
                                                                                         
ghc/driver/           The driver program for GHC;                                        
                      currently a perl script, <tt>ghc</tt>.                             
                                                                                         
ghc/compiler/         The Haskell compiler proper, called <tt>hsc</tt>;                  
                      source files are in <tt>compiler/*/[A-Z]*.lhs</tt>.                
                                                                                         
ghc/runtime/          The runtime system, including the garbage-collector(s).            
                                                                                         
ghc/lib/prelude/      Source for the linked-in code for the "standard prelude".          
ghc/lib/glaExts/      Source for the linked-in code for our Glasgow extensions.          
ghc/lib/haskell-1.3/  Source for the linked-in code for Haskell 1.3 I/O.                 
ghc/lib/hbc/          Source for the HBC `system library'.                               
ghc/lib/ghc/          Source for the GHC `system library'.                               
                                                                                         
ghc/includes/         The "public" .hi files slurped by the parser,                      
                      and .h files <tt>#include</tt>d in generated .hc files come from.  
                                                                                         
ghc/docs/             documents; see the README file there.                              
                                                                                         
ghc/CONTRIB/          reserved for contributed things                                    
haggis/               Haggis Haskell X11 GUI toolkit                                     
happy/                Happy Haskell parser generator                                     
nofib/                NoFib Haskell benchmark and test suite                             
</pre>



<address>Generated by The AQUA Team (scribe: Will Partain)  Department of Computing Science  University of Glasgow  Glasgow, Scotland  G12 8QQ    Email: glasgow-haskell-{users,bugs}-request@dcs.glasgow.ac.uk  using <tt>lit2html</tt></address></body></html>
